<%= javascript_include_tag 'post', 'data-turbolinks-track': 'reload' %>

<div class="container">
  <p></p>
  <div class="row">
    <div class="col-sm-4">
      <div class="card mb-3" style="max-width: 540px;">
        <div class="row">
          <div class="col-md-4 text-center">
            <% if @profile.image.attached? %>
              <%= image_tag(@profile.image, :class => "avatar img-circle img-thumbnail", :alt => "avatar", :size => "120x120") %>
            <% else %>
              <img class="img-thumbnail img-fluid" src="https://i.stack.imgur.com/34AD2.jpg" alt="avatar">
            <% end %>
          </div>
          <div class="col-md-8">
            <div class="card-body">
              <h6 class="card-title"><%= @profile.first_name %> </h6>
              <h6 class="card-title"><%= @profile.last_name %> </h6>
              <br>
              <p class="card-text"><%= @profile.bio %></p>
            </div>
          </div>
        </div>
      </div>

      <ul class="list-group">
        <li class="list-group-item">
          <h6><b><u>Email</u></b></h6>
          <%= @user.email %>
        </li>
        <li class="list-group-item">
          <h6><b><u>Country</u></b></h6>
          <%= @profile.country %>
        </li>
        <li class="list-group-item">
          <h6><b><u>City</u></b></h6>
          <%= @profile.city %>

        </li>
      </ul>
    </div>
    <div class="col-sm-8">
      <div class="container justify-content-xl-center">
        <div class="card">
          <div class="card-body">
            <%= render '/posts/form', post: @new_post %>
          </div>
        </div>
        <br>
        <% if @posts.length > 0 %>
          <ul class="list-group ">
            <% @posts.each do |post| %>
              <li class="list-group-item">
                <div class="card mb-3">
                <div class="card-header">
                  <div class="row">
                    <div class="col-md-10">
                      <% if @profile.image.attached? %>
                        <%= image_tag(@profile.image, :class => "avatar img-circle img-thumbnail", :alt => "avatar", :size => "50x50") %>
                      <% else %>
                        <img src="https://i.stack.imgur.com/34AD2.jpg" alt="avatar" class="post-user-image">
                      <% end %>
                      <a href="#">
                        <%= @profile.first_name %>
                      </a>
                    </div>
                    <div class="col-md-2 text-center">
                      <small><%= post.created_at.to_date %></small>
                    </div>
                  </div>
                </div>
                <div class="card-body text-left">
                  <div class="row">
                    <div class="col-md-10">
                      <a href="<%= post_path(post.id) %>" class="btn-outline-warning"><h5 class="card-title"><%= post.title %></h5></a>
                    </div>
                    <div class="col-md-2 text-center">
                      <% if post.solved %>
                        <i class="fas fa-check fa-2x"></i>
                      <% end %>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-12">
                      <p class="card-text"><%= post.description %></p>
                    </div>
                  </div>

                </div>
                <div class="card-footer">
                  <div class="row">
                    <div class="col-sm-8">
                      <a class="btn btn-dark" data-toggle="collapse" href="#collapseExample<%= post.id %>" role="button" aria-expanded="false" aria-controls="collapseExample<%= post.id %>">
                        Comments
                      </a>
                      <div class="collapse" id="collapseExample<%= post.id %>">
                        <div class="card card-body">
                          <ul class="list-group">
                            <% if @comments[post.id].present? %>
                              <% @comments[post.id].each do |comment|%>
                                <p></p>
                                <% if Profile.find_by_id(comment['user_profile_id']).image.attached? %>
                                  <%= image_tag(Profile.find_by_id(comment['user_profile_id']).image, :class => "avatar img-circle img-thumbnail", :alt => "avatar", :size => "30x30") %>
                                <% else %>
                                  <img src="https://i.stack.imgur.com/34AD2.jpg" alt="avatar" sizes="30x30">
                                <% end %>
                                <a href="<%= profile_path(comment['user_profile_id']) %>">
                                  <%= Profile.find_by_id(comment['user_profile_id']).first_name + " " +
                                          Profile.find_by_id(comment['user_profile_id']).last_name %>
                                </a>
                                <%= comment['text'] %>
                              <% end %>
                            <% else %>
                              <p> No comments yet </p>
                            <% end %>
                          </ul>
                          <div class="card card-body">
                              <textarea id="comment_post<%= post.id %>" name="<%= @new_comment %>">
                                <%= @new_comment %>
                              </textarea>
                            <a class="btn btn-dark" id="new_comment<%= post.id %>"
                               href="<%= new_comment_prof_path(:current_post => post.id, :comment => @new_comment) %>">
                              New Comment
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-sm-4 text-right">
                      <%= @votes[post.id]["up"] %>
                      <a class="btn">
                        <i class="fas fa-thumbs-up fa-hand-thumbs-up "></i>
                      </a>
                      <%= @votes[post.id]["down"] %>
                      <a class="btn">
                        <i class="fas fa-thumbs-down fa-hand-thumbs-down"></i>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="jumbotron">
            <h2>You have no posts yet</h2>
          </div>
        <% end %>
      </div>
    </div>
  </div>
  <p></p>
</div>